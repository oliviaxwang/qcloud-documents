## 功能描述

慢查询定义为超过指定时间的查询语句，对应语句称为慢查询语句。慢日志分析主要针对数据库**实例**与 **Proxy** 两个维度的慢查询数量进行统计分析，并给出专家级的优化建议，辅助提升数据库性能。

- 实例（Redis 数据库实例）维度：展示 CPU 使用率，慢查询数、日志分段耗时统计结果，和整个慢日志列表的信息。
- Proxy（中间件集群节点）维度：展示 Proxy 的慢日志统计、分段耗时情况，还有详细的慢日志列表信息。

## 查看慢日志分析数据

1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在左侧导航栏，选择**诊断优化**。
3. 在**数据库智能管家 DBbrain** 的**诊断优化**页面上方，在**实例 ID** 的下拉列表选择需查看的实例。
![](https://qcloudimg.tencent-cloud.cn/raw/1f2179f0f906241128c34c746c4ce79a.png)
4. 单击**慢日志分析**页签，在**统计**区域，选择查看慢日志的维度，并设置查询时间段。
   - 单击**实例**，查看实例维度的慢日志统计趋势图。
   - 单击 **Proxy节点**，在其后面的下拉列表中选择需分析的 Proxy ID，可根据**CPU使用率**的趋势图或**慢查询**数量变化的趋势图选择需分析的 **Proxy ID**。
   - 在时间框中，单击<img src="https://qcloudimg.tencent-cloud.cn/raw/a1438740099d1baedaf57020fb2e397b.png" style="zoom: 50%;" />，选择需查看的时间段，最长支持查看连续4天的慢日志。
<img src="https://qcloudimg.tencent-cloud.cn/raw/ad4d3d4e437861868dd7493b54ed8312.png" style="zoom: 50%;" />
5. 查看慢日志统计变化趋势、慢日志分段耗时统计、慢日志列表。
 - **慢日志统计变化趋势** 
   慢日志统计针对慢查询数量与 CPU 使用率两项指标，可快速识别所选时间段内慢查询数量持续偏高时 CPU 的使用情况，避免因慢查询数量过大引起 CPU 使用率过高，从而导致电脑卡顿或者无响应。
   ![img](https://main.qcloudimg.com/raw/533c6ac4e8e6ee1ac1f35105775bf4cd.png)
 - **慢日志分段耗时统计**   
   慢日志分段耗时统计展示 Proxy 节点慢查询耗时时间段占比，其中纵轴为耗时时段，横轴为分布占比。以下图为例，100%的慢查询耗时时长在10s - 15s区间内。
<img src="https://main.qcloudimg.com/raw/f60c0a52f9e26b5a4b31d5fa118bb4d3.png"  style="zoom:50%;">
 - **慢日志信息列表**
    - 慢日志列表，统计执行慢查询命令的执行次数、耗时情况。单击**导出**，可导出该数据在本地查看分析。
     <img src="https://main.qcloudimg.com/raw/333ef53b03b74842d9f6d1e8f0fc72ce.png" alt="img"  />
    - 单击某条命令模板行，可在右侧弹出的面板上查看命令模板的具体分析优化建议和统计数据。
      - 在**分析**页签，展示命令模板、命令样例、优化建议和说明。
      - 在**统计**页签，展示该类型的命令（聚合后汇总的）运行的时间分布区间。来源 IP 的访问分布及占比（proxy 有，Redis 没有）。
      ![img](https://main.qcloudimg.com/raw/c144821910a149ee51b807cc1f861627.png) 
 - **图表联动**
在**慢日志统计**的监控视图上，单击您要定位的时间点，可同时在右侧慢日志分段耗时视图中查看该时间不同耗时时段的占比，以及在下方慢日志列表中查看该时间的慢查询请求执行次数和耗时时长统计数据。
![img](https://main.qcloudimg.com/raw/8d0596fc23190dffd3371d15a4c3374b.png)
 - **监控详情**
在**慢日志统计**页面，单击右上角的**监控详情**，在弹出的对话框的下拉列表中，选择相关联的监控指标，并设置查看时间段，可比较该时段多个指标的最大值与平均值的统计数据。单击**添加时间对比**，也可对比两个时间段的统计数据。
![img](https://main.qcloudimg.com/raw/2c8b8f1be41ed82699aa8f1ef31f3124.png)

