## 操作场景
云数据库 Redis 兼容 Redis 2.8、4.0、5.0、6.0版本，支持进行兼容版本升级，同时支持升级小版本，帮助用户升级实例至更新版本，从而体验更丰富的功能。
>?如需使用 Redis  6.0版本，请 [提交工单](https://console.cloud.tencent.com/workorder/category)  申请。

## 版本差异说明

| 兼容版本  | 小版本 | 优化&修复                                                    |
| --------- | ------ | ------------------------------------------------------------ |
| Redis 4.0 | 4.3.0  | <li>从节点发现集群中有 Failing 节点，支持向集群发送消息，方便快速发现故障节点。</li><li>性能优化：在 BIO 线程中执行 zmalloc_get_rss()，避免阻塞主线程，造成请求延迟增高。</li><li>修复 rdbLoadRio() 函数，在某些场景下可能会触发宕机的问题。</li> |
| Redis 5.0 | 5.2.0  | <li>性能优化：在 BIO 线程中执行 zmalloc_get_rss()，避免阻塞主线程, 造成请求延迟增高。</li></li><li>修复 rdbLoadRio() 函数，在某些场景下可能会触发宕机的问题。</li> |
| Redis 6.0 | 6.0.0  | 兼容 Redis 6.0版本。 |

## 升级说明
- 目前仅标准架构实例支持升级兼容版本，集群架构不支持。
- 支持低版本实例向高版本升级，例如，Redis 4.0 升级至 Redis 5.0。
- 支持跨版本升级。
- 实例兼容版本升级，不涉及费用变更。
- 不支持降级兼容版本。
- 实例的小版本升级，系统会自动检测，不支持自定义目标版本。
- 由于各地域版本发布进度可能有所差异，小版本发布情况以当前控制台显示为准。

## 升级流程原理
![](https://qcloudimg.tencent-cloud.cn/raw/21b86c925f1841d0c54db61f0cf29dee.png)
1. 资源申请：申请新版本实例资源，包括 Proxy 资源、Redis 主节点和副本节点资源。
2. 同步数据：从低版本实例同步全量和增量数据至新版本实例。
3. 等待切换：等待数据同步完成，或者等待切换时间窗口。
4. 版本切换：到达切换条件（数据同步接近完成，并且符合切换时间窗口），用户停止旧版本实例写入，从旧版本实例解绑 VIP（Virtual IP Address），绑定 VIP 至新实例。
5. 升级完成：更新实例状态。

## 升级影响
版本升级过程主要为数据同步和实例切换两个过程：
- 数据同步过程中，对服务无影响。
- 数据切换过程中，实例将存在1分钟以内的只读状态（等待数据同步完成），以及连接闪断（秒级）的影响，需要业务具备自动重连的机制。

## 升级准备
- 待升级版本的实例处于正常状态下（运行中），并且当前没有任何任务执行。
- 已确认升级的目标版本。

## 升级版本
1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧实例列表页面上方，选择地域。
3. 在实例列表中，找到需升级版本的实例。
4. 单击其实例 ID，进入**实例详情**页面。
5. 在**实例详情**页面的**规格信息**区域，单击**兼容版本**后面的**版本升级**。
<img src="https://qcloudimg.tencent-cloud.cn/raw/74a45b595d2f1394364cdd9cf37d4403.png" style="zoom:67%;" />
6. 在弹出的对话框，根据下表确认待升级实例的信息，配置升级的目标版本，单击**确定**。
<img src="https://qcloudimg.tencent-cloud.cn/raw/e16ba3454af100769f0d777ffc5b2c7a.png" style="zoom:67%;" />
<table>
<thead>
<tr><th>参数名称</th><th>参数说明</th></tr></thead>
<tbody><tr>
<td>实例 ID</td><td>待升级实例的 ID。</td></tr>
<tr>
<td>实例名称</td><td>待升级实例的名称 。</td></tr>
<tr>
<td>兼容版本</td><td>待升级实例当前兼容 Redis 的版本。</td></tr>
<tr>
<td>架构版本</td>
<td>待升级实例的架构信息，当前仅支持标准架构升级版本。</td></tr>
<tr>
<td>内存容量</td><td>待升级实例的容量规格。</td></tr>
<tr>
<td>升级版本</td>
<td>请在下拉列表中选择升级的目标版本。支持低版本向高版本升级，且支持跨版本升级。</td></tr>
<tr>
<td>新规格预览</td><td>升级后实例规格预览信息。</td></tr>
<tr>
<td>切换时间</td>
<td><ul><li><strong>立即切换</strong>：数据同步接近完成（需同步的数据 &lt; 10MB），执行切换动作。</li><li><strong>维护时间窗切换</strong>：在实例的维护时间窗内，执行切换动作，如果在当前维护时间窗无法满足切换条件，将在下一次维护时间窗进行切换尝试。维护时间可在实例详情页的<strong>维护时间窗</strong>处修改。</li></ul></td></tr>
<tr>
<td>总费用</td><td>升级实例之后的费用，不涉及计费变更。</td></tr>
</tbody></table>
7. 在左侧导航栏，选择**任务管理**，等待任务执行完成，在实例列表查看实例的版本已经为升级后的版本。

## 升级小版本
1. 登录 [Redis 控制台](https://console.cloud.tencent.com/redis)。
2. 在右侧实例列表页面上方，选择地域。
3. 在实例列表中，找到需升级版本的实例。
4. 单击其实例 ID，进入**实例详情**页面。
5. 在**实例详情**页面的**规格信息**区域，单击**兼容版本**后面的**小版本升级**。
> !系统会自动检测小版本，如果**小版本升级**按钮无法选择，表示该实例已经是最新的小版本。
> 
<img src="https://qcloudimg.tencent-cloud.cn/raw/74a45b595d2f1394364cdd9cf37d4403.png" style="zoom:67%;" />
6. 在**升级小版本**的对话框，确认实例信息及其升级的版本信息，在切换时间，选择升级时间。
   - **立即切换**：数据同步接近完成（需同步的数据 < 10MB），执行切换动作。
   - **维护时间窗切换**：在实例的维护时间窗内，执行切换动作，如果在当前维护时间窗无法满足切换条件，将在下一次维护时间窗进行切换尝试。维护时间可在实例详情页的**维护时间窗**处修改。
<img src="https://qcloudimg.tencent-cloud.cn/raw/82f760e003f7a662116ddf9cfc642dab.png"  style="zoom:50%;">
7. 在左侧导航栏，选择**任务管理**，等待任务执行完成，在实例列表查看实例的版本已经为升级后的小版本。

## 相关 API

| 接口名称                                                     | 接口功能       |
| :----------------------------------------------------------- | :------------- |
| [UpgradeInstanceVersion](https://cloud.tencent.com/document/product/239/46334) | 升级实例版本   |
| [UpgradeSmallVersion](https://cloud.tencent.com/document/product/239/74596) | 升级实例小版本 |

