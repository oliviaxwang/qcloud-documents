## 操作场景

TSF 的日志服务，提供日志投递功能。您可通过配置日志投递规则，并将其发布至目标部署组，从而实现部署组日志的转存。

## 操作步骤

### 新建日志投递规则

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧菜单栏中，单击运维中心下的**日志服务** > **日志配置**，切换到**日志投递**标签页。
3. 单击**新建投递规则**，在弹出的**新建投递规则**弹框中输入您的规则设置。
![](https://qcloudimg.tencent-cloud.cn/raw/bcbd29f8319e9916e19cad65d8367b81.png)
   - 规则名称：必填，文本，长度限制32个字符
   - 接收端：日志转存至的目标位置
     - 仅支持设置一个接收端
     - 目前仅支持 Kafka 类型的接收端，您需设置 “IP:端口”、“域名:端口” 或“域名”，多个 Kafka 地址用","分隔。输入集群后可以检测集群状态，如果通过可以进行下一步操作；失败返回失败信息，您可以查看异常信息排查问题。
     - 所填写的 Kafka 集群，可为自建 Kafka 集群或腾讯云 CKafka
   - 投递配置：支持从不同路径采集到的日志投递到同一个 kafka 实例的不同 Topic 中，可通过**添加**按钮添加多个路径输入框，以设置多个路径。
     - 采集路径：需要具体到某一个日志文件
     - 投递 Topic：填写该目录的文件投递到具体哪一个 Topic 中
   - 高级设置：配置投递到 Kafka 的鉴权规则。当打开鉴权配置后，需要填写 Kafka 访问的用户名与密码。其中当投递目的地为腾讯云 CKafka 时，用户名和密码的填写方式可以参见文档 [配置 ACL 策略](https://cloud.tencent.com/document/product/597/31528)。
>!
>- 所配置的 Kafka 必须和应用部署的 VPC 相同。
>- 请在 CKafka 上开启白名单，以保证日志采集端和 Kafka 的网络联通性。
>- 日志采集路径请勿以 /data/tsf_apm 开头。
>- 同一个部署组上只支持添加一条投递规则。如果配置多条规则，最后配置的规则将覆盖原有规则。
4. 单击**保存&下一步**，进入绑定部署组页面。
5. 绑定部署组，并单击**完成**。
   规则创建完成后，您可将规则绑定至多个部署组。绑定后，此投递规则即会在所选的部署组中生效，部署组中规则指定路径下的日志，会被自动转存至目标接收端。
![](https://qcloudimg.tencent-cloud.cn/raw/841aa8f2b8a9b74afe8778390899e53a.png)

### 查看日志投递规则详情

日志投递规则创建后，会以列表项的形式呈现在**日志投递**页面的规则列表中。

1. 单击某列表项中的**规则 ID**，进入该规则的详情页。
2. 在规则详情页中，查看其基本信息和发布情况（规则已绑定的部署组列表）。
   

### 发布日志投递规则

投递规则创建完成后，您可通过**发布规则**将投递规则绑定至更多部署组。

1. 选择目标规则，进入发布规则页面。您可以通过以下任一方式操作：
   - 方式一：在投递规则列表页中找到目标规则，单击操作列的**发布规则**。
   - 方式二：进入目标规则的**规则详情** > **发布情况**页中，单击左上方的**发布规则**。
2. 选择所需绑定的部署组，单击**提交**即可。
>?已绑定当前规则的部署组不可被选中；已绑定其它规则的部署组，被绑定新规则时，部署组的投递规则被替换为新的规则。



### 修改部署组的投递规则

您可通过以下方式，修改部署组所绑定的投递规则。

- 方式一：您可通过将新的规则绑定至部署组，替换其原有投递规则。
- 方式二：在部署组的详情页的**基本信息**中，编辑其投递规则；选择新的规则并保存后，部署组的投递规则即更新为新选的规则。

![](https://qcloudimg.tencent-cloud.cn/raw/90895e3ea205733a709078f3ef3086d6.jpg)

### 编辑日志投递规则

规则创建成功后，您可随时修改规则的配置信息

1. 在规则列表页中找到所需修改的规则项，单击规则 ID 进入其详情页。
![](https://qcloudimg.tencent-cloud.cn/raw/4af1827c8610c58d7e2a208d064af6d0.jpg)
2. 单击详情页**基本信息**卡片右上方的“编辑”图标，在打开的**编辑投递规则**弹框中，编辑规则配置项后，单击**保存**即可。
   ![img](https://main.qcloudimg.com/raw/22ff82f4a02bdc67796ec46c3a22a255.jpg)
3. 规则修改完成后，自动在规则已绑定的部署组中生效。

### 删除日志投递规则

投递规则创建后，您也可以随时将其删除。

>!规则删除后，自动把该规则从所有已绑定该规则的部署组中清除，并停止此规则的日志投递。

1. 在投递规则列表页中找到目标规则，单击操作列中的**更多** > **删除**。
2. 二次确认后即可将规则删除。
![](https://qcloudimg.tencent-cloud.cn/raw/be06064de8ded7021cc0277e0c434ec3.jpg)
