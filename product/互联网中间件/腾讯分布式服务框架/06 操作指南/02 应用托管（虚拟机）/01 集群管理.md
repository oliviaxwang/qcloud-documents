## 操作场景

集群是指云资源管理的集合，包含了运行应用的云主机等资源。TSF 中的集群分为虚拟机集群和容器集群。使用虚拟机或者容器计算资源时，用户需要提前先将云主机导入集群中，才能进行应用的部署。

本文介绍在 TSF 控制台创建虚拟机集群并对集群进行管理的操作方法。

### 创建集群

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏中单击**集群管理**，选择好地域后，单击**新建**。
3. 设置集群的基本信息。
   - 集群类型：选择**虚拟机集群**。
   - 集群名：填写集群名称，最长60个字符。
   - 所在可用区：选择集群所在的可用区
   - 集群网络：选择与已有云服务器相同的 VPC 网络，用来保证后续导入集群的云服务器属于同一 VPC。
   - 标签：用于分类管理资源，可不选。详情参见 [标签](https://cloud.tencent.com/document/product/649/53869)。
   - 备注：集群的描述，不超过200个字符。
   - 数据集：将新建的集群添加到已有数据集中。非必填字段。数据集使用，请参见 [数据集管理](https://cloud.tencent.com/document/product/649/38326)。
4. 单击**提交**，在弹窗中选择**确认**，进入导入云主机页面。如果选择**取消**，您后续可以在集群列表中，单击操作列的**导入云主机**重新导入云主机。
5. 从集群所在 VPC 的云主机列表中，选择需要添加到集群的云主机。
6. 单击**下一步**，进行云主机配置。
    ![](https://main.qcloudimg.com/raw/64263b917cd2f1ca39eeaabaf79147b6.png)
      - 重装系统：该方式会使 root 用户安装 agent。重装后，云主机系统盘内的所有数据将被清除，恢复到初始状态，请谨慎操作！
      - 安装 Agent（仅适用于虚拟机集群）： 该方式支持使用 root 用户和非 root 用户安装 agent。使用安装 Agent 部署时，不会重装机器。
   您可以单击以下页签，查看对应导入方式的操作步骤。 
   <dx-tabs>
   ::: 重装系统
   >?CVM 竞价实例不支持重装系统。


   1. 云主机配置
      - 导入方式：选择**重装系统**。
      - 操作系统：支持两种不同操作系统选择：Ubuntu 18.04版本与 CentOS 7.5版本。
      - 登录方式：提供三种对应登录方式。
        - 设置密码：请根据提示设置对应密码。
        - 立即关联密钥：密钥对是通过一种算法生成的一对参数，是一种比常规密码更安全的登录云主机的方式。详请参阅 [SSH 密钥](https://cloud.tencent.com/document/product/213/6092)。
        - 自动生成密码：自动生成的密码将通过站内信发送给您，也可登录 CVM 控制台重置密码。
          ![](https://qcloudimg.tencent-cloud.cn/raw/24d343583180d25b280928054da51b39.png)
   2. 单击**提交**，导入的云主机将出现在云主机名列表中。等待几分钟，刷新列表，正常情况下云主机的状态将变为运行中，可用状态变为"可用"。
      :::
      ::: 安装\sAgent

   1. 导入方式选择**安装 Agent**，单击**提交**，在导入结果中页面复制 agent 安装脚本。后续您也可以通过单击云主机列表操作列的**安装 Agent **获取 agent 安装脚本。 
      ![](https://qcloudimg.tencent-cloud.cn/raw/1110224b9f91088e17b1fcb9129fed35.png)
   2. 单击**关闭**，返回云主机列表，此时导入的云主机可用状态显示“不可用”，选择云主机操作列的**登录**登录云主机。
      - root 用户安装 agent：直接粘贴脚本并执行。
      - 非 root 用户安装 agent：需要 root 用户新建好  `/data/tsf_apm/` 和 `/var/log/tsf/` 这两个目录，并赋予读写权限给tsf-agent的安装用户。tsf-agent 的安装用户就是部署应用的启动用户。粘贴脚本并执行。
   3. 下图为脚本执行成功后终端最后几条打印日志的截图。
      ![](https://qcloudimg.tencent-cloud.cn/raw/5cbbd47ed9554ad64f0794f0bd37e1e7.png)
   4. 脚本执行成功后，回到云主机列表，稍等片刻，云主机的可用状态会变为"可用"。
      ![](https://qcloudimg.tencent-cloud.cn/raw/da7efd75f4288b1ede7819450d5679dd.png)
      :::
      </dx-tabs>

导入云主机后，您可以在虚拟机集群服务中创建并部署应用，参见 [创建并部署应用](https://cloud.tencent.com/document/product/649/15524)。



#### 常见问题

导入云主机异常请参见 [资源管理常见问题](https://cloud.tencent.com/document/product/649/20270)。





### 移出云主机

>!只有当节点上没有运行应用时，才可以将节点从集群中移出。停止应用需要到部署组的实例列表页面中操作，具体操作参见 [应用管理](https://cloud.tencent.com/document/product/649/13686)。

1. 在集群列表页中，单击目标集群的**ID/名称**，进入集群的云主机列表页面。
2. 在云主机节点列表页面，选择需要移出的云主机，单击操作列的**删除**。
3. 在弹出的提示框中，单击**确定**将云主机移出节点。



### 删除集群

>!
>
>- 集群内存在云主机时，无法删除集群，您需要先移除云主机。
>- 集群在删除期间，无法对外提供服务，请提前做好准备，以免造成影响。

1. 在集群列表页中，单击目标集群操作列的**删除**。
2. 在弹出的提示框中，单击**确定**删除集群。



