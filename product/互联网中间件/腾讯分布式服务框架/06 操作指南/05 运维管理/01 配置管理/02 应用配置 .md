## 操作场景

**应用配置**生效在单个应用上面，发布的范围是部署组维度。应用配置功能**仅针对 Spring Cloud 应用，Dubbo 应用和 Go-gRPC 应用生效**，支持的功能如下：

- 创建配置项：一个配置项管理多个版本的配置。
- 生成新版本：基于历史版本生成新版本。
- 发布配置：支持发布配置到部署组。
- 查看发布情况：查看配置项发布到哪些部署组。
- 回滚：回滚到上一个版本的配置。

>?原生应用与 Mesh 应用不支持分布式配置。



## 前提条件

在使用控制台的应用配置功能前，请确保已经按照 [配置管理](https://cloud.tencent.com/document/product/649/16620) 配置了相关依赖项。



## 创建配置

应用配置功能有两个入口，一个入口是在单个应用的应用详情页内，另一个入口是在**配置管理**模块的**应用配置**。

1. 登录 [TSF 控制台](https://console.cloud.tencent.com/tsf/index)。
2. 在左侧导航栏，单击**配置管理** > **应用配置**，进入应用配置页面。
3. 在页面顶部选择好地域和关联应用后，单击**新建配置**，填写配置信息。
   - 配置名称：填写配置名名称，最长60个字符，只能包含字母、数字及分隔符（“-”、“\_”)，且不能以分隔符开头或结尾。
   - 配置内容：上传本地配置文件，使用 YAML 配置格式，YAML 格式规范参见 [YAML 格式介绍](https://cloud.tencent.com/document/product/649/17925)，如果本地使用 Properties 配置格式，查看 [将 Properties 转化为 YAML](https://www.toyaml.com/index.html)。
> !单个应用配置版本的大小不能超过65535个字节，如果应用的配置超过了该上限值，可以分成多个应用配置项发布到同一个部署组，多个配置会合并成一份配置。
   - 版本号：填写初始版本号。
   - 标签：用于分类管理资源，可留空。详情参见 [标签](https://cloud.tencent.com/document/product/649/53869)。
   - 版本描述：填写应用配置初始版本的描述。
   - 数据集：用于细粒度管理子账号权限，可留空。将应用配置添加到数据集中，数据集使用情参见 [数据集管理](https://cloud.tencent.com/document/product/649/38326)。
4. 单击**完成**。



## 发布配置

应用配置项创建完成后，用户需要将配置项发布到应用下的部署组上才能生效。

1. 在 [应用配置](https://console.cloud.tencent.com/tsf/config-app) 列表页，单击目标配置名称，进入详情页。
2. 在配置版本标签页，单击某个配置版本操作栏的**发布**，勾选配置发布的目标部署组，填写发布描述。
3. 单击**下一步**，对比当前配置版本和上一个版本的差异，确认无问题后单击**发布**。





## 生成新版本配置

1. 在 [应用配置](https://console.cloud.tencent.com/tsf/config-app) 列表页，单击目标配置名称，进入详情页。
2. 在配置版本标签页，单击某个配置版本操作栏的**生成新版本**，填写变更的新版本的配置内容和版本号。
> !新版本配置的版本号不能与原版本相同。
3. 单击**完成**。

新版本配置生成后，您需要将新版本配置发布到绑定应用下的部署组上，即可生效。



#### 配置合并逻辑说明

按照配置**下发时间**来排序执行合并（merge）。不同名的配置项中如果存在相同 key 会进行合并。合并规则：按照配置下发时间排序，离当前时间近的优先级较高。举例如下：

```
1. 创建配置项 config-abc，配置内容是 custom-key: value-1，发布时间 15:00:00
2. 创建配置项 config-bcd，配置内容是 custom-key: value-2， 发布时间15:00:01
```

最终在实例上生效的配置：`custom-key: value-2`



## 删除配置版本

> !删除后所有数据将被清除且不可恢复，请提前备份数据。

1. 在 [应用配置](https://console.cloud.tencent.com/tsf/config-app) 列表页，单击目标配置名称，进入详情页。
2. 在配置版本标签页，单击某个配置版本操作栏的**删除**，确认后即可删除该配置版本。



## 查看部署组的配置发布历史

用户可以通过**查看发布信息**查看该配置相关部署组的配置发布记录。

1. 在 [应用配置](https://console.cloud.tencent.com/tsf/config-app) 列表页，单击操作列的**查看发布信息**，进入发布情况页面。
2. 展开部署组，查看该部署组的配置发布记录。
3. 单击每条发布记录， 可查看配置发布前后区别。
   

## 回滚配置

回滚配置会将部署组的配置回滚到**上一次**发布的版本。

1. 在 [应用配置](https://console.cloud.tencent.com/tsf/config-app) 列表页，单击操作列的**查看发布信息**，进入发布情况页面。
2. 找到目标部署组，单击操作栏的**回滚**，可查看回滚前后配置变化。
3. 单击**提交**，完成回滚。
   

